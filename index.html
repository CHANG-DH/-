<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ì  ì´ë¦„ - ë©”ë‰´íŒ</title>
    <style>
        body { font-family: sans-serif; margin: 0; padding: 20px; background-color: #f4f4f4; }
        .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h1, h2 { text-align: center; color: #333; }
        .menu-item { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding: 15px 0; }
        .menu-info { flex-grow: 1; }
        .menu-name { font-weight: bold; font-size: 1.1em; }
        .menu-price { color: #888; }
        .quantity-control { display: flex; align-items: center; }
        .quantity-control button { width: 30px; height: 30px; border: 1px solid #ddd; background-color: #f9f9f9; cursor: pointer; font-size: 1.2em;}
        .quantity { padding: 0 15px; font-size: 1.1em; }
        #order-form { margin-top: 30px; text-align: center; }
        #table-number { width: 95%; padding: 10px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 4px; font-size: 1em; }
        #order-button { background-color: #ff5722; color: white; padding: 15px 0; border: none; border-radius: 5px; width: 100%; font-size: 1.2em; cursor: pointer; }
        #total-price { text-align: right; margin-top: 20px; font-size: 1.3em; font-weight: bold; }
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸ» ì£¼ì  ì´ë¦„ ğŸ»</h1>
    <h2>ë©”ë‰´íŒ</h2>
    <div id="menu-list"></div>
    <div id="total-price">ì´ ê¸ˆì•¡: 0ì›</div>
    <div id="order-form">
        <input type="number" id="table-number" placeholder="í…Œì´ë¸” ë²ˆí˜¸ë¥¼ ê¼­ ì…ë ¥í•´ì£¼ì„¸ìš”!">
        <button id="order-button">ì£¼ë¬¸í•˜ê¸°</button>
    </div>
</div>

<script>
    // âš ï¸ íŒë§¤í•  ë©”ë‰´ì™€ ê°€ê²©ì„ ì—¬ê¸°ì„œ ìˆ˜ì •í•˜ì„¸ìš”.
    const menuData = [
        { name: 'ì œìœ¡ë³¶ìŒ', price: 12000 },
        { name: 'í•´ë¬¼íŒŒì „', price: 10000 },
        { name: 'ê¹€ì¹˜ì°Œê°œ', price: 11000 },
        { name: 'ì†Œì£¼', price: 5000 },
        { name: 'ë§¥ì£¼', price: 5000 }
    ];

    // âš ï¸ ì—¬ê¸°ì— 3ë‹¨ê³„ì—ì„œ ë³µì‚¬í•œ 'ìƒˆë¡œìš´ ì›¹ ì•± URL'ì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”!
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyPAGAcS14xS0Yn2ZonPk2U0WAGrXRnru7slpYnkXgzY0jIkXZEJGwCgv7vhG_TjAkE4w/exec';

    const menuList = document.getElementById('menu-list');
    const totalPriceElement = document.getElementById('total-price');
    const orderButton = document.getElementById('order-button');
    const tableNumberInput = document.getElementById('table-number');
    let order = {};

    function renderMenu() {
        menuData.forEach((item, index) => {
            order[index] = { ...item, quantity: 0 };
            const menuItem = document.createElement('div');
            menuItem.className = 'menu-item';
            menuItem.innerHTML = `
                <div class="menu-info">
                    <div class="menu-name">${item.name}</div>
                    <div class="menu-price">${item.price.toLocaleString()}ì›</div>
                </div>
                <div class="quantity-control">
                    <button onclick="changeQuantity(${index}, -1)">-</button>
                    <span id="quantity-${index}" class="quantity">0</span>
                    <button onclick="changeQuantity(${index}, 1)">+</button>
                </div>
            `;
            menuList.appendChild(menuItem);
        });
    }

    function changeQuantity(index, delta) {
        if (order[index].quantity + delta >= 0) {
            order[index].quantity += delta;
            document.getElementById(`quantity-${index}`).innerText = order[index].quantity;
            updateTotalPrice();
        }
    }

    function updateTotalPrice() {
        let total = Object.values(order).reduce((sum, item) => sum + item.price * item.quantity, 0);
        totalPriceElement.innerText = `ì´ ê¸ˆì•¡: ${total.toLocaleString()}ì›`;
    }

    orderButton.addEventListener('click', () => {
        const tableNumber = tableNumberInput.value;
        if (!tableNumber) {
            alert('í…Œì´ë¸” ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
            return;
        }
        const itemsToOrder = Object.values(order).filter(item => item.quantity > 0);
        if (itemsToOrder.length === 0) {
            alert('ë©”ë‰´ë¥¼ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”!');
            return;
        }
        const totalAmount = itemsToOrder.reduce((sum, item) => sum + item.price * item.quantity, 0);
        const orderData = {
            tableNumber: tableNumber,
            totalAmount: totalAmount,
            items: itemsToOrder.map(item => ({ name: item.name, quantity: item.quantity }))
        };

        orderButton.disabled = true;
        orderButton.innerText = 'ì£¼ë¬¸ ì²˜ë¦¬ ì¤‘...';

        fetch(APPS_SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify(orderData),
            headers: { 'Content-Type': 'application/json' }
        })
        .then(response => response.json())
        .then(data => {
            if(data.result === 'success'){
                alert('ì£¼ë¬¸ì´ ì„±ê³µì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!');
                location.reload();
            } else {
                throw new Error(data.error);
            }
        })
        .catch(error => {
            console.error('ì£¼ë¬¸ ì‹¤íŒ¨:', error);
            alert('ì£¼ë¬¸ ì ‘ìˆ˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            orderButton.disabled = false;
            orderButton.innerText = 'ì£¼ë¬¸í•˜ê¸°';
        });
    });

    renderMenu();
</script>
</body>
</html>
